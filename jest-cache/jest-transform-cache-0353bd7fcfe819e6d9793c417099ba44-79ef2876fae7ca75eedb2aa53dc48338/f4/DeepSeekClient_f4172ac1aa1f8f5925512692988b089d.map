{"version":3,"names":["axios_1","cov_1mq0bs07p","s","__importDefault","require","DeepSeekClient","constructor","config","f","defaultModel","b","model","client","default","create","baseURL","apiBaseUrl","headers","apiKey","timeout","interceptors","response","use","error","handleApiError","createChatCompletion","request","payload","temperature","_b","_a","max_tokens","_d","_c","maxTokens","post","data","status","Error","message","generateSystemPrompt","format","generateUserPrompt","json","exports"],"sources":["C:\\Users\\hongping\\CascadeProjects\\json-sage-ai-agent\\src\\core\\deepseek\\DeepSeekClient.ts"],"sourcesContent":["import axios, { AxiosInstance } from 'axios';\r\nimport { DeepSeekConfig } from '../config/ConfigManager';\r\n\r\nexport interface ChatMessage {\r\n    role: 'system' | 'user' | 'assistant';\r\n    content: string;\r\n}\r\n\r\nexport interface ChatCompletionRequest {\r\n    messages: ChatMessage[];\r\n    model?: string;\r\n    temperature?: number;\r\n    max_tokens?: number;\r\n    stream?: boolean;\r\n}\r\n\r\nexport interface ChatCompletionResponse {\r\n    id: string;\r\n    object: string;\r\n    created: number;\r\n    model: string;\r\n    choices: {\r\n        index: number;\r\n        message: ChatMessage;\r\n        finish_reason: string;\r\n    }[];\r\n    usage: {\r\n        prompt_tokens: number;\r\n        completion_tokens: number;\r\n        total_tokens: number;\r\n    };\r\n}\r\n\r\nexport class DeepSeekClient {\r\n    private client: AxiosInstance;\r\n    private defaultModel: string;\r\n\r\n    constructor(private config: DeepSeekConfig) {\r\n        this.defaultModel = config.model || 'deepseek-chat';\r\n        this.client = axios.create({\r\n            baseURL: config.apiBaseUrl || 'https://api.deepseek.com/v1',\r\n            headers: {\r\n                'Authorization': `Bearer ${config.apiKey}`,\r\n                'Content-Type': 'application/json'\r\n            },\r\n            timeout: 30000 // 30 seconds timeout\r\n        });\r\n\r\n        // Add response interceptor for error handling\r\n        this.client.interceptors.response.use(\r\n            response => response,\r\n            error => this.handleApiError(error)\r\n        );\r\n    }\r\n\r\n    /**\r\n     * 创建聊天完成\r\n     */\r\n    public async createChatCompletion(\r\n        request: Omit<ChatCompletionRequest, 'model'> & { model?: string }\r\n    ): Promise<ChatCompletionResponse> {\r\n        const payload: ChatCompletionRequest = {\r\n            ...request,\r\n            model: request.model || this.defaultModel,\r\n            temperature: request.temperature ?? this.config.temperature ?? 0.7,\r\n            max_tokens: request.max_tokens ?? this.config.maxTokens ?? 2000\r\n        };\r\n\r\n        try {\r\n            const response = await this.client.post<ChatCompletionResponse>(\r\n                '/chat/completions',\r\n                payload\r\n            );\r\n            return response.data;\r\n        } catch (error) {\r\n            throw this.handleApiError(error);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 处理 API 错误\r\n     */\r\n    private handleApiError(error: any): never {\r\n        if (error.response) {\r\n            // API 响应的错误\r\n            const status = error.response.status;\r\n            const data = error.response.data;\r\n            \r\n            switch (status) {\r\n                case 401:\r\n                    throw new Error('Invalid API key. Please check your DeepSeek API credentials.');\r\n                case 403:\r\n                    throw new Error('API key does not have permission to access this resource.');\r\n                case 429:\r\n                    throw new Error('Rate limit exceeded. Please try again later.');\r\n                default:\r\n                    throw new Error(\r\n                        `DeepSeek API error (${status}): ${\r\n                            data.error?.message || 'Unknown error'\r\n                        }`\r\n                    );\r\n            }\r\n        } else if (error.request) {\r\n            // 请求发送失败\r\n            throw new Error(\r\n                'Failed to connect to DeepSeek API. Please check your internet connection.'\r\n            );\r\n        } else {\r\n            // 其他错误\r\n            throw new Error(`Error: ${error.message}`);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 生成系统提示\r\n     */\r\n    public static generateSystemPrompt(format: string = 'draft-07'): string {\r\n        return `You are a JSON Schema expert. Your task is to analyze JSON data and generate accurate JSON Schema definitions.\r\nPlease follow these guidelines:\r\n1. Use JSON Schema ${format} format\r\n2. Include detailed descriptions for each field\r\n3. Add appropriate examples where possible\r\n4. Infer proper types and formats\r\n5. Include validation rules when obvious from the data\r\n6. Keep the schema concise but comprehensive`;\r\n    }\r\n\r\n    /**\r\n     * 生成用户提示\r\n     */\r\n    public static generateUserPrompt(json: string): string {\r\n        return `Please generate a JSON Schema for the following JSON data. Include detailed descriptions and examples:\r\n\r\n${json}\r\n\r\nPlease provide only the JSON Schema as output, without any additional text or explanations.`;\r\n    }\r\n}\r\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;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","ignoreList":[]}