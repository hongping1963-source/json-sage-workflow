e7a08798383d76905ec4f9200cab763c
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const JsonSageAI_1 = require("../src/agent/JsonSageAI");
const NLUParser_1 = require("../src/agent/NLUParser");
const SchemaGenerator_1 = require("../src/agent/SchemaGenerator");
describe('JSON Schema Generation', () => {
    let agent;
    let nluParser;
    let schemaGenerator;
    beforeEach(() => {
        const config = {
            deepseekApiKey: 'test-key',
            model: 'test-model',
            maxTokens: 2000,
            temperature: 0.7
        };
        agent = new JsonSageAI_1.JsonSageAI(config);
        nluParser = new NLUParser_1.NLUParser();
        schemaGenerator = new SchemaGenerator_1.SchemaGenerator();
    });
    test('should correctly parse user input and generate schema', async () => {
        // 1. 测试用户输入
        const userInput = "帮我创建一个 JSON Schema，用于描述一个用户对象，包括姓名、年龄和邮箱。";
        // 2. 测试NLU解析
        const startTime = performance.now();
        const nluResult = await nluParser.parse(userInput);
        const nluTime = performance.now() - startTime;
        // 验证NLU解析结果
        expect(nluResult).toEqual({
            intent: "generate_schema",
            entity: "user",
            fields: [
                {
                    name: "姓名",
                    type: "string"
                },
                {
                    name: "年龄",
                    type: "number"
                },
                {
                    name: "邮箱",
                    type: "string",
                    format: "email"
                }
            ]
        });
        // 验证NLU解析时间
        expect(nluTime).toBeLessThan(200); // 应小于200ms
        // 3. 测试Schema生成
        const task = {
            jsonData: {
                name: "张三",
                age: 25,
                email: "zhangsan@example.com"
            },
            options: {
                includeDescriptions: true,
                includeExamples: true
            }
        };
        const schemaStartTime = performance.now();
        const result = await agent.generateSchema(task);
        const schemaTime = performance.now() - schemaStartTime;
        // 验证生成的Schema
        if (result.success) {
            expect(result.data.schema).toEqual({
                $schema: "http://json-schema.org/draft-07/schema#",
                type: "object",
                title: "用户对象",
                description: "描述用户的基本信息",
                properties: {
                    name: {
                        type: "string",
                        description: "用户姓名"
                    },
                    age: {
                        type: "integer",
                        description: "用户年龄",
                        minimum: 0
                    },
                    email: {
                        type: "string",
                        format: "email",
                        description: "用户邮箱地址"
                    }
                },
                required: ["name", "age", "email"]
            });
            // 验证Schema生成时间
            expect(schemaTime).toBeLessThan(400); // 应小于400ms
            // 4. 验证示例数据
            const testData = {
                name: "张三",
                age: 25,
                email: "zhangsan@example.com"
            };
            const validateResult = agent.validateSchema(result.data.schema, testData);
            expect(validateResult.valid).toBe(true);
        }
        else {
            fail('Schema generation failed');
        }
    });
    test('should handle field validation correctly', () => {
        const schema = {
            $schema: "http://json-schema.org/draft-07/schema#",
            type: "object",
            properties: {
                name: { type: "string" },
                age: { type: "integer", minimum: 0 },
                email: { type: "string", format: "email" }
            },
            required: ["name", "age", "email"]
        };
        // 测试有效数据
        const validData = {
            name: "张三",
            age: 25,
            email: "zhangsan@example.com"
        };
        expect(agent.validateSchema(schema, validData).valid).toBe(true);
        // 测试无效年龄
        const invalidAge = {
            name: "张三",
            age: -1,
            email: "zhangsan@example.com"
        };
        expect(agent.validateSchema(schema, invalidAge).valid).toBe(false);
        // 测试无效邮箱
        const invalidEmail = {
            name: "张三",
            age: 25,
            email: "invalid-email"
        };
        expect(agent.validateSchema(schema, invalidEmail).valid).toBe(false);
    });
    test('should handle error cases gracefully', async () => {
        // 测试空输入
        await expect(nluParser.parse("")).rejects.toThrow();
        // 测试无效输入
        await expect(nluParser.parse("这是一个无效的输入")).rejects.toThrow();
        // 测试缺失字段
        const task = {
            jsonData: {},
            options: {}
        };
        const result = await agent.generateSchema(task);
        expect(result.success).toBe(false);
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFxob25ncGluZ1xcQ2FzY2FkZVByb2plY3RzXFxqc29uLXNhZ2UtYWktYWdlbnRcXHRlc3RcXHNjaGVtYS1nZW5lcmF0aW9uLnRlc3QudHMiLCJtYXBwaW5ncyI6Ijs7QUFBQSx3REFBcUQ7QUFDckQsc0RBQW1EO0FBQ25ELGtFQUErRDtBQUcvRCxRQUFRLENBQUMsd0JBQXdCLEVBQUUsR0FBRyxFQUFFO0lBQ3BDLElBQUksS0FBaUIsQ0FBQztJQUN0QixJQUFJLFNBQW9CLENBQUM7SUFDekIsSUFBSSxlQUFnQyxDQUFDO0lBRXJDLFVBQVUsQ0FBQyxHQUFHLEVBQUU7UUFDWixNQUFNLE1BQU0sR0FBZ0I7WUFDeEIsY0FBYyxFQUFFLFVBQVU7WUFDMUIsS0FBSyxFQUFFLFlBQVk7WUFDbkIsU0FBUyxFQUFFLElBQUk7WUFDZixXQUFXLEVBQUUsR0FBRztTQUNuQixDQUFDO1FBQ0YsS0FBSyxHQUFHLElBQUksdUJBQVUsQ0FBQyxNQUFNLENBQUMsQ0FBQztRQUMvQixTQUFTLEdBQUcsSUFBSSxxQkFBUyxFQUFFLENBQUM7UUFDNUIsZUFBZSxHQUFHLElBQUksaUNBQWUsRUFBRSxDQUFDO0lBQzVDLENBQUMsQ0FBQyxDQUFDO0lBRUgsSUFBSSxDQUFDLHVEQUF1RCxFQUFFLEtBQUssSUFBSSxFQUFFO1FBQ3JFLFlBQVk7UUFDWixNQUFNLFNBQVMsR0FBRywyQ0FBMkMsQ0FBQztRQUU5RCxhQUFhO1FBQ2IsTUFBTSxTQUFTLEdBQUcsV0FBVyxDQUFDLEdBQUcsRUFBRSxDQUFDO1FBQ3BDLE1BQU0sU0FBUyxHQUFHLE1BQU0sU0FBUyxDQUFDLEtBQUssQ0FBQyxTQUFTLENBQUMsQ0FBQztRQUNuRCxNQUFNLE9BQU8sR0FBRyxXQUFXLENBQUMsR0FBRyxFQUFFLEdBQUcsU0FBUyxDQUFDO1FBRTlDLFlBQVk7UUFDWixNQUFNLENBQUMsU0FBUyxDQUFDLENBQUMsT0FBTyxDQUFDO1lBQ3RCLE1BQU0sRUFBRSxpQkFBaUI7WUFDekIsTUFBTSxFQUFFLE1BQU07WUFDZCxNQUFN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QUFFLENBQUM7UUFFcEQsU0FBUztRQUNULE1BQU0sTUFBTSxDQUFDLFNBQVMsQ0FBQyxLQUFLLENBQUMsV0FBVyxDQUFDLENBQUMsQ0FBQyxPQUFPLENBQUMsT0FBTyxFQUFFLENBQUM7UUFFN0QsU0FBUztRQUNULE1BQU0sSUFBSSxHQUF5QjtZQUMvQixRQUFRLEVBQUUsRUFBRTtZQUNaLE9BQU8sRUFBRSxFQUFFO1NBQ2QsQ0FBQztRQUNGLE1BQU0sTUFBTSxHQUFHLE1BQU0sS0FBSyxDQUFDLGNBQWMsQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUNoRCxNQUFNLENBQUMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQztJQUN2QyxDQUFDLENBQUMsQ0FBQztBQUNQLENBQUMsQ0FBQyxDQUFDIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIkM6XFxVc2Vyc1xcaG9uZ3BpbmdcXENhc2NhZGVQcm9qZWN0c1xcanNvbi1zYWdlLWFpLWFnZW50XFx0ZXN0XFxzY2hlbWEtZ2VuZXJhdGlvbi50ZXN0LnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEpzb25TYWdlQUkgfSBmcm9tICcuLi9zcmMvYWdlbnQvSnNvblNhZ2VBSSc7XG5pbXBvcnQgeyBOTFVQYXJzZXIgfSBmcm9tICcuLi9zcmMvYWdlbnQvTkxVUGFyc2VyJztcbmltcG9ydCB7IFNjaGVtYUdlbmVyYXRvciB9IGZyb20gJy4uL3NyYy9hZ2VudC9TY2hlbWFHZW5lcmF0b3InO1xuaW1wb3J0IHsgQWdlbnRDb25maWcsIFNjaGVtYUdlbmVyYXRpb25UYXNrLCBOTFVSZXN1bHQgfSBmcm9tICcuLi9zcmMvdHlwZXMnO1xuXG5kZXNjcmliZSgnSlNPTiBTY2hlbWEgR2VuZXJhdGlvbicsICgpID0+IHtcbiAgICBsZXQgYWdlbnQ6IEpzb25TYWdlQUk7XG4gICAgbGV0IG5sdVBhcnNlcjogTkxVUGFyc2VyO1xuICAgIGxldCBzY2hlbWFHZW5lcmF0b3I6IFNjaGVtYUdlbmVyYXRvcjtcblxuICAgIGJlZm9yZUVhY2goKCkgPT4ge1xuICAgICAgICBjb25zdCBjb25maWc6IEFnZW50Q29uZmlnID0ge1xuICAgICAgICAgICAgZGVlcHNlZWtBcGlLZXk6ICd0ZXN0LWtleScsXG4gICAgICAgICAgICBtb2RlbDogJ3Rlc3QtbW9kZWwnLFxuICAgICAgICAgICAgbWF4VG9rZW5zOiAyMDAwLFxuICAgICAgICAgICAgdGVtcGVyYXR1cmU6IDAuN1xuICAgICAgICB9O1xuICAgICAgICBhZ2VudCA9IG5ldyBKc29uU2FnZUFJKGNvbmZpZyk7XG4gICAgICAgIG5sdVBhcnNlciA9IG5ldyBOTFVQYXJzZXIoKTtcbiAgICAgICAgc2NoZW1hR2VuZXJhdG9yID0gbmV3IFNjaGVtYUdlbmVyYXRvcigpO1xuICAgIH0pO1xuXG4gICAgdGVzdCgnc2hvdWxkIGNvcnJlY3RseSBwYXJzZSB1c2VyIGlucHV0IGFuZCBnZW5lcmF0ZSBzY2hlbWEnLCBhc3luYyAoKSA9PiB7XG4gICAgICAgIC8vIDEuIOa1i+ivleeUqOaIt+i+k+WFpVxuICAgICAgICBjb25zdCB1c2VySW5wdXQgPSBcIuW4ruaIkeWIm+W7uuS4gOS4qiBKU09OIFNjaGVtYe+8jOeUqOS6juaPj+i/sOS4gOS4queUqOaIt+Wvueixoe+8jOWMheaLrOWnk+WQjeOAgeW5tOm+hOWSjOmCrueuseOAglwiO1xuXG4gICAgICAgIC8vIDIuIOa1i+ivlU5MVeino+aekFxuICAgICAgICBjb25zdCBzdGFydFRpbWUgPSBwZXJmb3JtYW5jZS5ub3coKTtcbiAgICAgICAgY29uc3Qgbmx1UmVzdWx0ID0gYXdhaXQgbmx1UGFyc2VyLnBhcnNlKHVzZXJJbnB1dCk7XG4gICAgICAgIGNvbnN0IG5sdVRpbWUgPSBwZXJmb3JtYW5jZS5ub3coKSAtIHN0YXJ0VGltZTtcblxuICAgICAgICAvLyDpqozor4FOTFXop6PmnpDnu5PmnpxcbiAgICAgICAgZXhwZWN0KG5sdVJlc3VsdCkudG9FcXVhbCh7XG4gICAgICAgICAgICBpbnRlbnQ6IFwiZ2VuZXJhdGVfc2NoZW1hXCIsXG4gICAgICAgICAgICBlbnRpdHk6IFwidXNlclwiLFxuICAgICAgICAgICAgZmllbGRzOiBbXG4gICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICBuYW1lOiBcIuWnk+WQjVwiLFxuICAgICAgICAgICAgICAgICAgICB0eXBlOiBcInN0cmluZ1wiXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgIG5hbWU6IFwi5bm06b6EXCIsXG4gICAgICAgICAgICAgICAgICAgIHR5cGU6IFwibnVtYmVyXCJcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgbmFtZTogXCLpgq7nrrFcIixcbiAgICAgICAgICAgICAgICAgICAgdHlwZTogXCJzdHJpbmdcIixcbiAgICAgICAgICAgICAgICAgICAgZm9ybWF0OiBcImVtYWlsXCJcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICBdXG4gICAgICAgIH0gYXMgTkxVUmVzdWx0KTtcblxuICAgICAgICAvLyDpqozor4FOTFXop6PmnpDml7bpl7RcbiAgICAgICAgZXhwZWN0KG5sdVRpbWUpLnRvQmVMZXNzVGhhbigyMDApOyAvLyDlupTlsI/kuo4yMDBtc1xuXG4gICAgICAgIC8vIDMuIOa1i+ivlVNjaGVtYeeUn+aIkFxuICAgICAgICBjb25zdCB0YXNrOiBTY2hlbWFHZW5lcmF0aW9uVGFzayA9IHtcbiAgICAgICAgICAgIGpzb25EYXRhOiB7XG4gICAgICAgICAgICAgICAgbmFtZTogXCLlvKDkuIlcIixcbiAgICAgICAgICAgICAgICBhZ2U6IDI1LFxuICAgICAgICAgICAgICAgIGVtYWlsOiBcInpoYW5nc2FuQGV4YW1wbGUuY29tXCJcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBvcHRpb25zOiB7XG4gICAgICAgICAgICAgICAgaW5jbHVkZURlc2NyaXB0aW9uczogdHJ1ZSxcbiAgICAgICAgICAgICAgICBpbmNsdWRlRXhhbXBsZXM6IHRydWVcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcblxuICAgICAgICBjb25zdCBzY2hlbWFTdGFydFRpbWUgPSBwZXJmb3JtYW5jZS5ub3coKTtcbiAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgYWdlbnQuZ2VuZXJhdGVTY2hlbWEodGFzayk7XG4gICAgICAgIGNvbnN0IHNjaGVtYVRpbWUgPSBwZXJmb3JtYW5jZS5ub3coKSAtIHNjaGVtYVN0YXJ0VGltZTtcblxuICAgICAgICAvLyDpqozor4HnlJ/miJDnmoRTY2hlbWFcbiAgICAgICAgaWYgKHJlc3VsdC5zdWNjZXNzKSB7XG4gICAgICAgICAgICBleHBlY3QocmVzdWx0LmRhdGEuc2NoZW1hKS50b0VxdWFsKHtcbiAgICAgICAgICAgICAgICAkc2NoZW1hOiBcImh0dHA6Ly9qc29uLXNjaGVtYS5vcmcvZHJhZnQtMDcvc2NoZW1hI1wiLFxuICAgICAgICAgICAgICAgIHR5cGU6IFwib2JqZWN0XCIsXG4gICAgICAgICAgICAgICAgdGl0bGU6IFwi55So5oi35a+56LGhXCIsXG4gICAgICAgICAgICAgICAgZGVzY3JpcHRpb246IFwi5o+P6L+w55So5oi355qE5Z+65pys5L+h5oGvXCIsXG4gICAgICAgICAgICAgICAgcHJvcGVydGllczoge1xuICAgICAgICAgICAgICAgICAgICBuYW1lOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiBcInN0cmluZ1wiLFxuICAgICAgICAgICAgICAgICAgICAgICAgZGVzY3JpcHRpb246IFwi55So5oi35aeT5ZCNXCJcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgYWdlOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiBcImludGVnZXJcIixcbiAgICAgICAgICAgICAgICAgICAgICAgIGRlc2NyaXB0aW9uOiBcIueUqOaIt+W5tOm+hFwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgbWluaW11bTogMFxuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICBlbWFpbDoge1xuICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogXCJzdHJpbmdcIixcbiAgICAgICAgICAgICAgICAgICAgICAgIGZvcm1hdDogXCJlbWFpbFwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgZGVzY3JpcHRpb246IFwi55So5oi36YKu566x5Zyw5Z2AXCJcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgcmVxdWlyZWQ6IFtcIm5hbWVcIiwgXCJhZ2VcIiwgXCJlbWFpbFwiXVxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIC8vIOmqjOivgVNjaGVtYeeUn+aIkOaXtumXtFxuICAgICAgICAgICAgZXhwZWN0KHNjaGVtYVRpbWUpLnRvQmVMZXNzVGhhbig0MDApOyAvLyDlupTlsI/kuo40MDBtc1xuXG4gICAgICAgICAgICAvLyA0LiDpqozor4HnpLrkvovmlbDmja5cbiAgICAgICAgICAgIGNvbnN0IHRlc3REYXRhID0ge1xuICAgICAgICAgICAgICAgIG5hbWU6IFwi5byg5LiJXCIsXG4gICAgICAgICAgICAgICAgYWdlOiAyNSxcbiAgICAgICAgICAgICAgICBlbWFpbDogXCJ6aGFuZ3NhbkBleGFtcGxlLmNvbVwiXG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICBjb25zdCB2YWxpZGF0ZVJlc3VsdCA9IGFnZW50LnZhbGlkYXRlU2NoZW1hKHJlc3VsdC5kYXRhLnNjaGVtYSwgdGVzdERhdGEpO1xuICAgICAgICAgICAgZXhwZWN0KHZhbGlkYXRlUmVzdWx0LnZhbGlkKS50b0JlKHRydWUpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgZmFpbCgnU2NoZW1hIGdlbmVyYXRpb24gZmFpbGVkJyk7XG4gICAgICAgIH1cbiAgICB9KTtcblxuICAgIHRlc3QoJ3Nob3VsZCBoYW5kbGUgZmllbGQgdmFsaWRhdGlvbiBjb3JyZWN0bHknLCAoKSA9PiB7XG4gICAgICAgIGNvbnN0IHNjaGVtYSA9IHtcbiAgICAgICAgICAgICRzY2hlbWE6IFwiaHR0cDovL2pzb24tc2NoZW1hLm9yZy9kcmFmdC0wNy9zY2hlbWEjXCIsXG4gICAgICAgICAgICB0eXBlOiBcIm9iamVjdFwiLFxuICAgICAgICAgICAgcHJvcGVydGllczoge1xuICAgICAgICAgICAgICAgIG5hbWU6IHsgdHlwZTogXCJzdHJpbmdcIiB9LFxuICAgICAgICAgICAgICAgIGFnZTogeyB0eXBlOiBcImludGVnZXJcIiwgbWluaW11bTogMCB9LFxuICAgICAgICAgICAgICAgIGVtYWlsOiB7IHR5cGU6IFwic3RyaW5nXCIsIGZvcm1hdDogXCJlbWFpbFwiIH1cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICByZXF1aXJlZDogW1wibmFtZVwiLCBcImFnZVwiLCBcImVtYWlsXCJdXG4gICAgICAgIH07XG5cbiAgICAgICAgLy8g5rWL6K+V5pyJ5pWI5pWw5o2uXG4gICAgICAgIGNvbnN0IHZhbGlkRGF0YSA9IHtcbiAgICAgICAgICAgIG5hbWU6IFwi5byg5LiJXCIsXG4gICAgICAgICAgICBhZ2U6IDI1LFxuICAgICAgICAgICAgZW1haWw6IFwiemhhbmdzYW5AZXhhbXBsZS5jb21cIlxuICAgICAgICB9O1xuICAgICAgICBleHBlY3QoYWdlbnQudmFsaWRhdGVTY2hlbWEoc2NoZW1hLCB2YWxpZERhdGEpLnZhbGlkKS50b0JlKHRydWUpO1xuXG4gICAgICAgIC8vIOa1i+ivleaXoOaViOW5tOm+hFxuICAgICAgICBjb25zdCBpbnZhbGlkQWdlID0ge1xuICAgICAgICAgICAgbmFtZTogXCLlvKDkuIlcIixcbiAgICAgICAgICAgIGFnZTogLTEsXG4gICAgICAgICAgICBlbWFpbDogXCJ6aGFuZ3NhbkBleGFtcGxlLmNvbVwiXG4gICAgICAgIH07XG4gICAgICAgIGV4cGVjdChhZ2VudC52YWxpZGF0ZVNjaGVtYShzY2hlbWEsIGludmFsaWRBZ2UpLnZhbGlkKS50b0JlKGZhbHNlKTtcblxuICAgICAgICAvLyDmtYvor5Xml6DmlYjpgq7nrrFcbiAgICAgICAgY29uc3QgaW52YWxpZEVtYWlsID0ge1xuICAgICAgICAgICAgbmFtZTogXCLlvKDkuIlcIixcbiAgICAgICAgICAgIGFnZTogMjUsXG4gICAgICAgICAgICBlbWFpbDogXCJpbnZhbGlkLWVtYWlsXCJcbiAgICAgICAgfTtcbiAgICAgICAgZXhwZWN0KGFnZW50LnZhbGlkYXRlU2NoZW1hKHNjaGVtYSwgaW52YWxpZEVtYWlsKS52YWxpZCkudG9CZShmYWxzZSk7XG4gICAgfSk7XG5cbiAgICB0ZXN0KCdzaG91bGQgaGFuZGxlIGVycm9yIGNhc2VzIGdyYWNlZnVsbHknLCBhc3luYyAoKSA9PiB7XG4gICAgICAgIC8vIOa1i+ivleepuui+k+WFpVxuICAgICAgICBhd2FpdCBleHBlY3Qobmx1UGFyc2VyLnBhcnNlKFwiXCIpKS5yZWplY3RzLnRvVGhyb3coKTtcblxuICAgICAgICAvLyDmtYvor5Xml6DmlYjovpPlhaVcbiAgICAgICAgYXdhaXQgZXhwZWN0KG5sdVBhcnNlci5wYXJzZShcIui/meaYr+S4gOS4quaXoOaViOeahOi+k+WFpVwiKSkucmVqZWN0cy50b1Rocm93KCk7XG5cbiAgICAgICAgLy8g5rWL6K+V57y65aSx5a2X5q61XG4gICAgICAgIGNvbnN0IHRhc2s6IFNjaGVtYUdlbmVyYXRpb25UYXNrID0ge1xuICAgICAgICAgICAganNvbkRhdGE6IHt9LFxuICAgICAgICAgICAgb3B0aW9uczoge31cbiAgICAgICAgfTtcbiAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgYWdlbnQuZ2VuZXJhdGVTY2hlbWEodGFzayk7XG4gICAgICAgIGV4cGVjdChyZXN1bHQuc3VjY2VzcykudG9CZShmYWxzZSk7XG4gICAgfSk7XG59KTtcbiJdLCJ2ZXJzaW9uIjozfQ==