{"file":"C:\\Users\\hongping\\CascadeProjects\\json-sage-ai-agent\\test\\schema-generation.test.ts","mappings":"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","names":[],"sources":["C:\\Users\\hongping\\CascadeProjects\\json-sage-ai-agent\\test\\schema-generation.test.ts"],"sourcesContent":["import { JsonSageAI } from '../src/agent/JsonSageAI';\nimport { NLUParser } from '../src/agent/NLUParser';\nimport { SchemaGenerator } from '../src/agent/SchemaGenerator';\nimport { AgentConfig, SchemaGenerationTask, NLUResult } from '../src/types';\n\ndescribe('Product Schema Generation', () => {\n    let agent: JsonSageAI;\n    let nluParser: NLUParser;\n    let schemaGenerator: SchemaGenerator;\n\n    beforeEach(() => {\n        const config: AgentConfig = {\n            deepseekApiKey: 'test-key',\n            model: 'test-model',\n            maxTokens: 2000,\n            temperature: 0.7\n        };\n        agent = new JsonSageAI(config);\n        nluParser = new NLUParser();\n        schemaGenerator = new SchemaGenerator();\n    });\n\n    test('should generate product schema with name, price, and description', async () => {\n        // 1. 测试用户输入\n        const userInput = \"为一个产品对象生成JSON Schema，包括名称、价格和描述。\";\n\n        // 2. 测试NLU解析\n        const startTime = performance.now();\n        const nluResult = await nluParser.parse(userInput);\n        const nluTime = performance.now() - startTime;\n\n        // 验证NLU解析结果\n        expect(nluResult).toEqual({\n            intent: \"generate_schema\",\n            entity: \"product\",\n            fields: [\n                {\n                    name: \"名称\",\n                    type: \"string\"\n                },\n                {\n                    name: \"价格\",\n                    type: \"number\"\n                },\n                {\n                    name: \"描述\",\n                    type: \"string\"\n                }\n            ]\n        } as NLUResult);\n\n        // 验证NLU解析时间\n        expect(nluTime).toBeLessThan(200); // 应小于200ms\n\n        // 3. 测试Schema生成\n        const task: SchemaGenerationTask = {\n            jsonData: {\n                name: \"智能手表\",\n                price: 1299.99,\n                description: \"一款功能强大的智能手表，支持心率监测和运动追踪\"\n            },\n            options: {\n                includeDescriptions: true,\n                includeExamples: true\n            }\n        };\n\n        const schemaStartTime = performance.now();\n        const result = await agent.generateSchema(task);\n        const schemaTime = performance.now() - schemaStartTime;\n\n        // 验证生成的Schema\n        if (result.success) {\n            expect(result.data.schema).toEqual({\n                $schema: \"http://json-schema.org/draft-07/schema#\",\n                type: \"object\",\n                title: \"产品对象\",\n                description: \"描述产品的基本信息\",\n                properties: {\n                    name: {\n                        type: \"string\",\n                        description: \"产品名称\",\n                        minLength: 1\n                    },\n                    price: {\n                        type: \"number\",\n                        description: \"产品价格\",\n                        minimum: 0\n                    },\n                    description: {\n                        type: \"string\",\n                        description: \"产品描述\",\n                        minLength: 1\n                    }\n                },\n                required: [\"name\", \"price\", \"description\"]\n            });\n\n            // 验证Schema生成时间\n            expect(schemaTime).toBeLessThan(400); // 应小于400ms\n\n            // 4. 验证示例数据\n            const testData = {\n                name: \"智能手表\",\n                price: 1299.99,\n                description: \"一款功能强大的智能手表，支持心率监测和运动追踪\"\n            };\n\n            const validateResult = agent.validateSchema(result.data.schema, testData);\n            expect(validateResult.valid).toBe(true);\n        } else {\n            fail('Schema generation failed');\n        }\n    });\n\n    test('should validate product data correctly', () => {\n        const schema = {\n            $schema: \"http://json-schema.org/draft-07/schema#\",\n            type: \"object\",\n            properties: {\n                name: {\n                    type: \"string\",\n                    minLength: 1\n                },\n                price: {\n                    type: \"number\",\n                    minimum: 0\n                },\n                description: {\n                    type: \"string\",\n                    minLength: 1\n                }\n            },\n            required: [\"name\", \"price\", \"description\"]\n        };\n\n        // 测试有效数据\n        const validProduct = {\n            name: \"智能手表\",\n            price: 1299.99,\n            description: \"一款功能强大的智能手表\"\n        };\n        expect(agent.validateSchema(schema, validProduct).valid).toBe(true);\n\n        // 测试无效价格\n        const invalidPrice = {\n            name: \"智能手表\",\n            price: -1,\n            description: \"一款功能强大的智能手表\"\n        };\n        expect(agent.validateSchema(schema, invalidPrice).valid).toBe(false);\n\n        // 测试空名称\n        const emptyName = {\n            name: \"\",\n            price: 1299.99,\n            description: \"一款功能强大的智能手表\"\n        };\n        expect(agent.validateSchema(schema, emptyName).valid).toBe(false);\n    });\n\n    test('should handle error cases gracefully', async () => {\n        // 测试空输入\n        await expect(nluParser.parse(\"\")).rejects.toThrow();\n\n        // 测试无效输入\n        await expect(nluParser.parse(\"这是一个无效的输入\")).rejects.toThrow();\n\n        // 测试缺失字段\n        const task: SchemaGenerationTask = {\n            jsonData: {\n                name: \"智能手表\"\n                // 缺少价格和描述\n            },\n            options: {}\n        };\n        const result = await agent.generateSchema(task);\n        expect(result.success).toBe(false);\n    });\n});\n"],"version":3}