b61130fd5f44add18ce1f46c8fc09bf6
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const Workflow_1 = require("../core/Workflow");
describe('JsonSageWorkflow', () => {
    let workflow;
    describe('Basic Functionality', () => {
        beforeEach(() => {
            workflow = new Workflow_1.JsonSageWorkflow({
                watch: false,
                autoProcess: false,
                generateTypes: false,
                autoOptimize: false,
                compression: false,
                validation: false,
                caching: false
            });
        });
        it('should parse JSON string', () => {
            const testData = { test: 'value' };
            const jsonString = JSON.stringify(testData);
            expect(workflow.parse(jsonString)).toEqual(testData);
        });
        it('should stringify data', () => {
            const testData = { test: 'value' };
            const result = workflow.stringify(testData);
            expect(JSON.parse(result)).toEqual(testData);
        });
    });
    describe('Advanced Features', () => {
        beforeEach(() => {
            workflow = new Workflow_1.JsonSageWorkflow({
                watch: true,
                autoProcess: true,
                generateTypes: true,
                autoOptimize: true,
                compression: true,
                validation: true,
                caching: true
            });
        });
        it('should use cache for parsing', async () => {
            const testData = { test: 'value' };
            const jsonString = JSON.stringify(testData);
            // First parse should cache
            const firstResult = workflow.parse(jsonString);
            expect(firstResult).toEqual(testData);
            // Second parse should use cache
            const secondResult = workflow.parse(jsonString);
            expect(secondResult).toEqual(testData);
        });
        it('should use cache for stringifying', () => {
            const testData = { test: 'value' };
            // First stringify should cache
            const firstResult = workflow.stringify(testData);
            // Second stringify should use cache
            const secondResult = workflow.stringify(testData);
            expect(firstResult).toBe(secondResult);
        });
        it('should handle compression', () => {
            const testData = { test: 'value'.repeat(100) }; // Large enough to trigger compression
            const jsonString = workflow.stringify(testData);
            const parsed = workflow.parse(jsonString);
            expect(parsed).toEqual(testData);
        });
        it('should validate and repair data', () => {
            const testData = { number: '123' }; // Number as string
            const jsonString = JSON.stringify(testData);
            const result = workflow.parse(jsonString);
            expect(result.number).toBe(123); // Should be converted to number
        });
    });
    describe('Error Handling', () => {
        beforeEach(() => {
            workflow = new Workflow_1.JsonSageWorkflow();
        });
        it('should handle invalid JSON', () => {
            expect(() => workflow.parse('invalid json')).toThrow();
        });
        it('should handle circular references', () => {
            const circular = { name: 'test' };
            circular.self = circular;
            expect(() => workflow.stringify(circular)).toThrow();
        });
        it('should handle initialization errors', async () => {
            const consoleSpy = jest.spyOn(console, 'error').mockImplementation();
            const badWorkflow = new Workflow_1.JsonSageWorkflow({
                watch: true,
                autoProcess: true,
                generateTypes: true,
                autoOptimize: true
            });
            // Wait for initialization to complete
            await new Promise(resolve => setTimeout(resolve, 100));
            expect(consoleSpy).toHaveBeenCalled();
            consoleSpy.mockRestore();
        });
    });
    describe('Performance Reporting', () => {
        beforeEach(() => {
            workflow = new Workflow_1.JsonSageWorkflow({
                compression: true,
                caching: true
            });
        });
        it('should generate performance report', async () => {
            const report = await workflow.getPerformanceReport();
            expect(report).toHaveProperty('cache');
            expect(report).toHaveProperty('compression');
            expect(report.compression).toHaveProperty('enabled', true);
            expect(report.compression).toHaveProperty('analysis');
        });
        it('should include cache statistics', async () => {
            const testData = { test: 'value' };
            workflow.parse(JSON.stringify(testData)); // Add something to cache
            const report = await workflow.getPerformanceReport();
            expect(report.cache).toHaveProperty('itemCount');
            expect(report.cache.itemCount).toBeGreaterThan(0);
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFxob25ncGluZ1xcQ2FzY2FkZVByb2plY3RzXFxqc29uLXNhZ2UtYWktYWdlbnRcXHNyY1xcX190ZXN0c19fXFx3b3JrZmxvdy50ZXN0LnRzIiwibWFwcGluZ3MiOiI7O0FBQUEsK0NBQW9EO0FBRXBELFFBQVEsQ0FBQyxrQkFBa0IsRUFBRSxHQUFHLEVBQUU7SUFDOUIsSUFBSSxRQUEwQixDQUFDO0lBRS9CLFFBQVEsQ0FBQyxxQkFBcUIsRUFBRSxHQUFHLEVBQUU7UUFDakMsVUFBVSxDQUFDLEdBQUcsRUFBRTtZQUNaLFFBQVEsR0FBRyxJQUFJLDJCQUFnQixDQUFDO2dCQUM1QixLQUFLLEVBQUUsS0FBSztnQkFDWixXQUFXLEVBQUUsS0FBSztnQkFDbEIsYUFBYSxFQUFFLEtBQUs7Z0JBQ3BCLFlBQVksRUFBRSxLQUFLO2dCQUNuQixXQUFXLEVBQUUsS0FBSztnQkFDbEIsVUFBVSxFQUFFLEtBQUs7Z0JBQ2pCLE9BQU8sRUFBRSxLQUFLO2FBQ2pCLENBQUMsQ0FBQztRQUNQLENBQUMsQ0FBQyxDQUFDO1FBRUgsRUFBRSxDQUFDLDBCQUEwQixFQUFFLEdBQUcsRUFBRTtZQUNoQyxNQUFNLFFBQVEsR0FBRyxFQUFFLElBQUksRUFBRSxPQUFPLEVBQUUsQ0FBQztZQUNuQyxNQUFNLFVBQVUsR0FBRyxJQUFJLENBQUMsU0FBUyxDQUFDLFFBQVEsQ0FBQyxDQUFDO1lBQzVDLE1BQU0sQ0FBQyxRQUFRLENBQUMsS0FBSyxDQUFDLFVBQVUsQ0FBQyxDQUFDLENBQUMsT0FBTyxDQUFDLFFBQVEsQ0FBQyxDQUFDO1FBQ3pELENBQUMsQ0FBQyxDQUFDO1FBRUgsRUFBRSxDQUFDLHVCQUF1QixFQUFFLEdBQUcsRUFBRTtZQUM3QixNQUFNLFFBQVEsR0FBRyxFQUFFLElBQUksRUFBRSxPQUFPLEVBQUUsQ0FBQztZQUNuQyxNQUFNLE1BQU0sR0FBRyxRQUFRLENBQUMsU0FBUyxDQUFDLFFBQVEsQ0FBQyxDQUFDO1lBQzVDLE1BQU0sQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLE1B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QyxlQUFlLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDdEQsQ0FBQyxDQUFDLENBQUM7SUFDUCxDQUFDLENBQUMsQ0FBQztBQUNQLENBQUMsQ0FBQyxDQUFDIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIkM6XFxVc2Vyc1xcaG9uZ3BpbmdcXENhc2NhZGVQcm9qZWN0c1xcanNvbi1zYWdlLWFpLWFnZW50XFxzcmNcXF9fdGVzdHNfX1xcd29ya2Zsb3cudGVzdC50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBKc29uU2FnZVdvcmtmbG93IH0gZnJvbSAnLi4vY29yZS9Xb3JrZmxvdyc7XHJcblxyXG5kZXNjcmliZSgnSnNvblNhZ2VXb3JrZmxvdycsICgpID0+IHtcclxuICAgIGxldCB3b3JrZmxvdzogSnNvblNhZ2VXb3JrZmxvdztcclxuXHJcbiAgICBkZXNjcmliZSgnQmFzaWMgRnVuY3Rpb25hbGl0eScsICgpID0+IHtcclxuICAgICAgICBiZWZvcmVFYWNoKCgpID0+IHtcclxuICAgICAgICAgICAgd29ya2Zsb3cgPSBuZXcgSnNvblNhZ2VXb3JrZmxvdyh7XHJcbiAgICAgICAgICAgICAgICB3YXRjaDogZmFsc2UsXHJcbiAgICAgICAgICAgICAgICBhdXRvUHJvY2VzczogZmFsc2UsXHJcbiAgICAgICAgICAgICAgICBnZW5lcmF0ZVR5cGVzOiBmYWxzZSxcclxuICAgICAgICAgICAgICAgIGF1dG9PcHRpbWl6ZTogZmFsc2UsXHJcbiAgICAgICAgICAgICAgICBjb21wcmVzc2lvbjogZmFsc2UsXHJcbiAgICAgICAgICAgICAgICB2YWxpZGF0aW9uOiBmYWxzZSxcclxuICAgICAgICAgICAgICAgIGNhY2hpbmc6IGZhbHNlXHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICBpdCgnc2hvdWxkIHBhcnNlIEpTT04gc3RyaW5nJywgKCkgPT4ge1xyXG4gICAgICAgICAgICBjb25zdCB0ZXN0RGF0YSA9IHsgdGVzdDogJ3ZhbHVlJyB9O1xyXG4gICAgICAgICAgICBjb25zdCBqc29uU3RyaW5nID0gSlNPTi5zdHJpbmdpZnkodGVzdERhdGEpO1xyXG4gICAgICAgICAgICBleHBlY3Qod29ya2Zsb3cucGFyc2UoanNvblN0cmluZykpLnRvRXF1YWwodGVzdERhdGEpO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICBpdCgnc2hvdWxkIHN0cmluZ2lmeSBkYXRhJywgKCkgPT4ge1xyXG4gICAgICAgICAgICBjb25zdCB0ZXN0RGF0YSA9IHsgdGVzdDogJ3ZhbHVlJyB9O1xyXG4gICAgICAgICAgICBjb25zdCByZXN1bHQgPSB3b3JrZmxvdy5zdHJpbmdpZnkodGVzdERhdGEpO1xyXG4gICAgICAgICAgICBleHBlY3QoSlNPTi5wYXJzZShyZXN1bHQpKS50b0VxdWFsKHRlc3REYXRhKTtcclxuICAgICAgICB9KTtcclxuICAgIH0pO1xyXG5cclxuICAgIGRlc2NyaWJlKCdBZHZhbmNlZCBGZWF0dXJlcycsICgpID0+IHtcclxuICAgICAgICBiZWZvcmVFYWNoKCgpID0+IHtcclxuICAgICAgICAgICAgd29ya2Zsb3cgPSBuZXcgSnNvblNhZ2VXb3JrZmxvdyh7XHJcbiAgICAgICAgICAgICAgICB3YXRjaDogdHJ1ZSxcclxuICAgICAgICAgICAgICAgIGF1dG9Qcm9jZXNzOiB0cnVlLFxyXG4gICAgICAgICAgICAgICAgZ2VuZXJhdGVUeXBlczogdHJ1ZSxcclxuICAgICAgICAgICAgICAgIGF1dG9PcHRpbWl6ZTogdHJ1ZSxcclxuICAgICAgICAgICAgICAgIGNvbXByZXNzaW9uOiB0cnVlLFxyXG4gICAgICAgICAgICAgICAgdmFsaWRhdGlvbjogdHJ1ZSxcclxuICAgICAgICAgICAgICAgIGNhY2hpbmc6IHRydWVcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIGl0KCdzaG91bGQgdXNlIGNhY2hlIGZvciBwYXJzaW5nJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICAgICAgICBjb25zdCB0ZXN0RGF0YSA9IHsgdGVzdDogJ3ZhbHVlJyB9O1xyXG4gICAgICAgICAgICBjb25zdCBqc29uU3RyaW5nID0gSlNPTi5zdHJpbmdpZnkodGVzdERhdGEpO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgLy8gRmlyc3QgcGFyc2Ugc2hvdWxkIGNhY2hlXHJcbiAgICAgICAgICAgIGNvbnN0IGZpcnN0UmVzdWx0ID0gd29ya2Zsb3cucGFyc2UoanNvblN0cmluZyk7XHJcbiAgICAgICAgICAgIGV4cGVjdChmaXJzdFJlc3VsdCkudG9FcXVhbCh0ZXN0RGF0YSk7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAvLyBTZWNvbmQgcGFyc2Ugc2hvdWxkIHVzZSBjYWNoZVxyXG4gICAgICAgICAgICBjb25zdCBzZWNvbmRSZXN1bHQgPSB3b3JrZmxvdy5wYXJzZShqc29uU3RyaW5nKTtcclxuICAgICAgICAgICAgZXhwZWN0KHNlY29uZFJlc3VsdCkudG9FcXVhbCh0ZXN0RGF0YSk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIGl0KCdzaG91bGQgdXNlIGNhY2hlIGZvciBzdHJpbmdpZnlpbmcnLCAoKSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IHRlc3REYXRhID0geyB0ZXN0OiAndmFsdWUnIH07XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAvLyBGaXJzdCBzdHJpbmdpZnkgc2hvdWxkIGNhY2hlXHJcbiAgICAgICAgICAgIGNvbnN0IGZpcnN0UmVzdWx0ID0gd29ya2Zsb3cuc3RyaW5naWZ5KHRlc3REYXRhKTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIC8vIFNlY29uZCBzdHJpbmdpZnkgc2hvdWxkIHVzZSBjYWNoZVxyXG4gICAgICAgICAgICBjb25zdCBzZWNvbmRSZXN1bHQgPSB3b3JrZmxvdy5zdHJpbmdpZnkodGVzdERhdGEpO1xyXG4gICAgICAgICAgICBleHBlY3QoZmlyc3RSZXN1bHQpLnRvQmUoc2Vjb25kUmVzdWx0KTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgaXQoJ3Nob3VsZCBoYW5kbGUgY29tcHJlc3Npb24nLCAoKSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IHRlc3REYXRhID0geyB0ZXN0OiAndmFsdWUnLnJlcGVhdCgxMDApIH07IC8vIExhcmdlIGVub3VnaCB0byB0cmlnZ2VyIGNvbXByZXNzaW9uXHJcbiAgICAgICAgICAgIGNvbnN0IGpzb25TdHJpbmcgPSB3b3JrZmxvdy5zdHJpbmdpZnkodGVzdERhdGEpO1xyXG4gICAgICAgICAgICBjb25zdCBwYXJzZWQgPSB3b3JrZmxvdy5wYXJzZShqc29uU3RyaW5nKTtcclxuICAgICAgICAgICAgZXhwZWN0KHBhcnNlZCkudG9FcXVhbCh0ZXN0RGF0YSk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIGl0KCdzaG91bGQgdmFsaWRhdGUgYW5kIHJlcGFpciBkYXRhJywgKCkgPT4ge1xyXG4gICAgICAgICAgICBjb25zdCB0ZXN0RGF0YSA9IHsgbnVtYmVyOiAnMTIzJyB9OyAvLyBOdW1iZXIgYXMgc3RyaW5nXHJcbiAgICAgICAgICAgIGNvbnN0IGpzb25TdHJpbmcgPSBKU09OLnN0cmluZ2lmeSh0ZXN0RGF0YSk7XHJcbiAgICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IHdvcmtmbG93LnBhcnNlKGpzb25TdHJpbmcpO1xyXG4gICAgICAgICAgICBleHBlY3QocmVzdWx0Lm51bWJlcikudG9CZSgxMjMpOyAvLyBTaG91bGQgYmUgY29udmVydGVkIHRvIG51bWJlclxyXG4gICAgICAgIH0pO1xyXG4gICAgfSk7XHJcblxyXG4gICAgZGVzY3JpYmUoJ0Vycm9yIEhhbmRsaW5nJywgKCkgPT4ge1xyXG4gICAgICAgIGJlZm9yZUVhY2goKCkgPT4ge1xyXG4gICAgICAgICAgICB3b3JrZmxvdyA9IG5ldyBKc29uU2FnZVdvcmtmbG93KCk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIGl0KCdzaG91bGQgaGFuZGxlIGludmFsaWQgSlNPTicsICgpID0+IHtcclxuICAgICAgICAgICAgZXhwZWN0KCgpID0+IHdvcmtmbG93LnBhcnNlKCdpbnZhbGlkIGpzb24nKSkudG9UaHJvdygpO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICBpdCgnc2hvdWxkIGhhbmRsZSBjaXJjdWxhciByZWZlcmVuY2VzJywgKCkgPT4ge1xyXG4gICAgICAgICAgICBjb25zdCBjaXJjdWxhcjogYW55ID0geyBuYW1lOiAndGVzdCcgfTtcclxuICAgICAgICAgICAgY2lyY3VsYXIuc2VsZiA9IGNpcmN1bGFyO1xyXG4gICAgICAgICAgICBleHBlY3QoKCkgPT4gd29ya2Zsb3cuc3RyaW5naWZ5KGNpcmN1bGFyKSkudG9UaHJvdygpO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICBpdCgnc2hvdWxkIGhhbmRsZSBpbml0aWFsaXphdGlvbiBlcnJvcnMnLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IGNvbnNvbGVTcHkgPSBqZXN0LnNweU9uKGNvbnNvbGUsICdlcnJvcicpLm1vY2tJbXBsZW1lbnRhdGlvbigpO1xyXG4gICAgICAgICAgICBjb25zdCBiYWRXb3JrZmxvdyA9IG5ldyBKc29uU2FnZVdvcmtmbG93KHtcclxuICAgICAgICAgICAgICAgIHdhdGNoOiB0cnVlLFxyXG4gICAgICAgICAgICAgICAgYXV0b1Byb2Nlc3M6IHRydWUsXHJcbiAgICAgICAgICAgICAgICBnZW5lcmF0ZVR5cGVzOiB0cnVlLFxyXG4gICAgICAgICAgICAgICAgYXV0b09wdGltaXplOiB0cnVlXHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgLy8gV2FpdCBmb3IgaW5pdGlhbGl6YXRpb24gdG8gY29tcGxldGVcclxuICAgICAgICAgICAgYXdhaXQgbmV3IFByb21pc2UocmVzb2x2ZSA9PiBzZXRUaW1lb3V0KHJlc29sdmUsIDEwMCkpO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgZXhwZWN0KGNvbnNvbGVTcHkpLnRvSGF2ZUJlZW5DYWxsZWQoKTtcclxuICAgICAgICAgICAgY29uc29sZVNweS5tb2NrUmVzdG9yZSgpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfSk7XHJcblxyXG4gICAgZGVzY3JpYmUoJ1BlcmZvcm1hbmNlIFJlcG9ydGluZycsICgpID0+IHtcclxuICAgICAgICBiZWZvcmVFYWNoKCgpID0+IHtcclxuICAgICAgICAgICAgd29ya2Zsb3cgPSBuZXcgSnNvblNhZ2VXb3JrZmxvdyh7XHJcbiAgICAgICAgICAgICAgICBjb21wcmVzc2lvbjogdHJ1ZSxcclxuICAgICAgICAgICAgICAgIGNhY2hpbmc6IHRydWVcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIGl0KCdzaG91bGQgZ2VuZXJhdGUgcGVyZm9ybWFuY2UgcmVwb3J0JywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICAgICAgICBjb25zdCByZXBvcnQgPSBhd2FpdCB3b3JrZmxvdy5nZXRQZXJmb3JtYW5jZVJlcG9ydCgpO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgZXhwZWN0KHJlcG9ydCkudG9IYXZlUHJvcGVydHkoJ2NhY2hlJyk7XHJcbiAgICAgICAgICAgIGV4cGVjdChyZXBvcnQpLnRvSGF2ZVByb3BlcnR5KCdjb21wcmVzc2lvbicpO1xyXG4gICAgICAgICAgICBleHBlY3QocmVwb3J0LmNvbXByZXNzaW9uKS50b0hhdmVQcm9wZXJ0eSgnZW5hYmxlZCcsIHRydWUpO1xyXG4gICAgICAgICAgICBleHBlY3QocmVwb3J0LmNvbXByZXNzaW9uKS50b0hhdmVQcm9wZXJ0eSgnYW5hbHlzaXMnKTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgaXQoJ3Nob3VsZCBpbmNsdWRlIGNhY2hlIHN0YXRpc3RpY3MnLCBhc3luYyAoKSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IHRlc3REYXRhID0geyB0ZXN0OiAndmFsdWUnIH07XHJcbiAgICAgICAgICAgIHdvcmtmbG93LnBhcnNlKEpTT04uc3RyaW5naWZ5KHRlc3REYXRhKSk7IC8vIEFkZCBzb21ldGhpbmcgdG8gY2FjaGVcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIGNvbnN0IHJlcG9ydCA9IGF3YWl0IHdvcmtmbG93LmdldFBlcmZvcm1hbmNlUmVwb3J0KCk7XHJcbiAgICAgICAgICAgIGV4cGVjdChyZXBvcnQuY2FjaGUpLnRvSGF2ZVByb3BlcnR5KCdpdGVtQ291bnQnKTtcclxuICAgICAgICAgICAgZXhwZWN0KHJlcG9ydC5jYWNoZS5pdGVtQ291bnQpLnRvQmVHcmVhdGVyVGhhbigwKTtcclxuICAgICAgICB9KTtcclxuICAgIH0pO1xyXG59KTtcclxuIl0sInZlcnNpb24iOjN9